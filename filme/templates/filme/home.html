<!DOCTYPE html>
<html>
<head>
    <title>Filme Populare</title>
    <style>
        img { width: 200px; }
        .film { display: inline-block; margin: 10px; text-align: center; width: 220px; }
    </style>
</head>
<body>
    <h1>Recomandari pe Banda</h1> 
    {% if user.is_authenticated %}
        <p>Bun venit, {{ user.username }}! <a href="{% url 'logout' %}">Deconectează-te</a></p>
    {% else %}
        <p><a href="{% url 'login' %}">Autentifică-te</a> | <a href="{% url 'register' %}">Înregistrează-te</a></p>
    {% endif %}

    {% if user.is_authenticated %}
    <p><a href="{% url 'lista_favorite' %}">Vezi favoritele tale</a></p>
    {% endif %}

    {% if user.is_authenticated %}
    <a href="{% url 'istoric_vizionari' %}">Istoric vizionări</a>
    {% endif %}

    <form method="GET" action="{% url 'cautare_filme' %}" style="margin: 20px 0; position: relative;">
        <input type="text" id="search-input" name="q" placeholder="Caută un film..." required style="padding: 5px; width: 200px;" autocomplete="off">
        <button type="submit" style="padding: 5px 10px;">Caută</button>
        <div id="suggestions" style="position: absolute; background: white; border: 1px solid #ccc; width: 200px; z-index: 1000;"></div>
    </form>


    <h3>Filme Populare</h3>
    {% for film in filme %}
        <div class="film">
            <a href="{% url 'detalii_film' film.id %}">
                <img src="https://image.tmdb.org/t/p/w200{{ film.poster_path }}" alt="{{ film.title }}">
                <h3>{{ film.title }}</h3>
            </a>
            <p>Data lansare: {{ film.release_date}}</p>
        </div>
    {% endfor %}
    <script>
    document.addEventListener('DOMContentLoaded', function () {
        const input = document.getElementById('search-input');
        const suggestionsBox = document.getElementById('suggestions');

        input.addEventListener('input', function () {
            const query = input.value;
            if (query.length < 2) {
             suggestionsBox.innerHTML = '';
                return;
            }

            fetch(`/autocomplete?q=${encodeURIComponent(query)}`)
                .then(response => response.json())
                .then(data => {
                    suggestionsBox.innerHTML = '';
                    data.results.slice(0, 3).forEach(film => {
                        const div = document.createElement('div');
                        div.innerHTML = `<a href="/film/${film.id}/" style="display:block; padding: 5px; text-decoration:none;">${film.title}</a>`;
                        suggestionsBox.appendChild(div);
                    });
                });
        });

        document.addEventListener('click', function (e) {
            if (!suggestionsBox.contains(e.target) && e.target !== input) {
                suggestionsBox.innerHTML = '';
            }
        });
    });
    </script>

</body>
</html>
